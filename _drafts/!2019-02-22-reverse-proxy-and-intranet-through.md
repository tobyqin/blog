---
title: 反向代理和内网穿透
categories: [Tech]
tags: [reverse-proxy,frp,ngrok]
date: 2019-02-22
---

## 概念

反向代理看上去看深奥，其实不然，只是因为汉语言文化的差异导致它看上去深奥。一般反派感觉都比较厉害和神秘。

要理解反向代理，我们就不得不说一下正向代理。

### 正向代理 （Forward Proxy）

所谓正向代理，就是大家通常说的代理。打个通俗的比方，你想跟你舅舅借钱，但不好开口（或者你舅妈会设法阻拦），就跟你妈说。这时母亲大人就是个正向代理。此时代理本质就是个桥的作用，这个桥让你能和桥对面的人交换信息。

![](images\1550823489351.png)

正向代理是多对一的概念，例如你姐，你妹你可以通过你妈去跟舅舅借钱，但舅舅只有一个舅舅。舅舅有可能并不知道到底是谁真正在借钱，只知道钱给了你妈。

### 反向代理 （Reserve Proxy）

这个例子来自知乎，大家都有打客服电话的经历，比如10086，一般上来就是个语音系统，转接人工服务后嘟嘟嘟好几声才有人接听，说我是工号xxx，很高兴为你服务。这个客服总机号码10086就是个反向代理，

![](images\1550824448581.png)

反向代理隐藏了真实的服务端，有可能有N个客服对应N个号码，但你只需要记一个10086，它会平衡客服之间的压力给你安排合适的人。

反向代理是一对多的概念，刚好和正向代理反过来了。

- 正向代理代理的对象是客户端
- 反向代理代理的对象是服务端

反向最常见的作用就是负载均衡。比如你访问baidu的域名后，baidu会根据你的ip地址和网络情况给你分配最快的服务器，这个分配服务器的服务器就是反向代理。

![](images\1550825022784.png)

## 内网穿透

从外网是没办法直接访问到内网的资源的，因为内网是一个局域网不在一个网段，而且还有防火墙在。

![1550826381553](images/1550826381553.png)

这时候你弄个反向代理就可以解决这个问题：

- 内网服务器访问代理服务器
- 握手，建立通道
- 外网用户访问代理，代理通过通道和内网通信

![1550827052394](images/1550827052394.png)

举一个例子，你可以通过TeamViewer连接内网机器，TeamViewer的服务端（外网）就是个反向代理，它需要和TeamViewer客户端（内网）一直保持通信，建立一个通道。当你要连接远程机器时就会通过这个通道完成。

## 一些反向代理服务

远程连接内网机器的桌面服务是最常见的需求，有时候我们希望做的是自己的机器上跑一些服务能够从外网访问，比如小程序的API，博客，甚至私有云等等。

