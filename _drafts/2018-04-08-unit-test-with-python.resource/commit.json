{"compress":true,"commitItems":[["0682acc3-73e6-407e-9a5f-2806ad209c4e",1523976473952,"---\ntitle: 说说Python中的单元测试\ncategories: [Tech]\ntags: [Python,unittest,pytest]\ndate: 2018-04-08\n---\n\n单元测试是每种编程语言必学的课题，是保护开发者的强力护盾，每个程序员都在时间允许的情况下尽可能多的写单元测试，今天我们不讨论其必要性，只抛砖引玉聊一聊Python中单元测试的恩怨情仇。本文仅代表个人看法，仅供参考。\n\n## 标准库中难以忍受的unittest\n\n很多时候我们总是认为标准库里的带的总是精挑细选的，如果不经过仔细打磨怎么可能入选为一等公民？然后我要告诉你，Python标准库里的单元测试框架真不是最好的，随着你对Python的熟悉你甚至会讨厌这个unittest，为什么呢？\n\n因为Python一直崇尚简单，优雅，高效地完成事情，当你写完一个函数需要测试一下时，使用标准库你需要做这些事情：\n\n- 新建单元测试脚本\n- 导入单元测试依赖\n- **继承单元测试类**\n- 实现单元测试方法\n\n具体的实例代码如下：\n\n```python\nimport unittest\n\nclass IntegerArithmeticTestCase(unittest.TestCase):\n    def testAdd(self):  # test method names begin with 'test'\n        self.assertEqual((1 + 2), 3)\n        self.assertEqual(0 + 1, 1)\n\nif __name__ == '__main__':\n    unittest.main()\n```\n\n看上去还行，不是很难。但是渐渐地你会吐槽：\n\n- 为啥我要新建一个文件来写测试？\n- 为啥我要继承一个类来写测试？\n- 为啥我要用unittest的Assertion来做断言？\n- 为啥unitunit的命名规则跟最佳实践不一样（`mixedCase` vs `lower_case`）？\n\n要回答以上问题，答案只有一个：[历史原因](https://www.quora.com/Will-Pythons-unittest-module-become-pythonic-anytime-soon)。\n\n很久很久以前，Python从Java借鉴了单元测试框架，包括命名规则和实现方式，一直沿用至今。不得不说这个框架没啥毛病，该有的功能的都有，想做的事都可以做，但是用起来总是没有爽的感觉。\n\n但是为啥伟大的社区力量为啥不把这个框架改的爽一点呢？没办法，为了兼容和世界和平，你要知道Python这个庞然大物能健康地活着，后面有无数的类库和方法在支撑，而这些类库和方法都被单元测试保护着，如果修改了单元测试框架导致case挂了，你就成了千古罪人。\n\n## 见识简洁的单元测试\n\nPython中很多大牛其实都有严重的强迫症，追求简洁和优雅的代码。必然的，他们会抛弃标准库中的unittest，使用或者发明自己心仪的单元测试框架。\n\n### pytest\n\n正如其名，这是一个无数人推荐并在使用的Python单元测试框架，\n\n## 让单元测试和IDE无缝集成\n\n## 闲话和总结",[[1523976433561,["tobyqin@CatBook.local",[[1,1334,"pytest 使用起来非常简单，只要你的方法名是一"]],[1334,1334],[1359,1359]]],[1523976434270,["tobyqin@CatBook.local",[[-1,1358,"一"]],[1359,1359],[1358,1358]]],[1523976436663,["tobyqin@CatBook.local",[[1,1358,"以 ``"]],[1358,1358],[1362,1362]]],[1523976438599,["tobyqin@CatBook.local",[[1,1361,"test_"]],[1361,1361],[1366,1366]]],[1523976473536,["tobyqin@CatBook.local",[[1,1367," 开头就可以，你可以和需要测试的方法放在一起，亦或是新建一个文件来专门存放"]],[1367,1367],[1404,1404]]],[1523976484225,["tobyqin@CatBook.local",[[1,1404,"单元测试，都可以。"]],[1404,1404],[1413,1413]]],[1523976484590,["tobyqin@CatBook.local",[[1,1415,"\n"]],[1413,1413],[1414,1414]]],[1523976485406,["tobyqin@CatBook.local",[[1,1416,"\n"]],[1414,1414],[1415,1415]]],[1523976486384,["tobyqin@CatBook.local",[[1,1415,"```"]],[1415,1415],[1418,1418]]],[1523976486846,["tobyqin@CatBook.local",[[1,1420,"\n"]],[1418,1418],[1419,1419]]],[1523976488456,["tobyqin@CatBook.local",[[1,1419,"```"]],[1419,1419],[1422,1422]]],[1523976492015,["tobyqin@CatBook.local",[[1,1418,"python"]],[1418,1418],[1424,1424]]],[1523976492374,["tobyqin@CatBook.local",[[1,1425,"\n"]],[1424,1424],[1425,1425]]],[1523976492662,["tobyqin@CatBook.local",[[1,1426,"\n"]],[1425,1425],[1426,1426]]],[1523976493662,["tobyqin@CatBook.local",[[-1,1426,"\n"]],[1426,1426],[1425,1425]]],[1523976495623,["tobyqin@CatBook.local",[[1,1425,"def func"]],[1425,1425],[1433,1433]]],[1523976497550,["tobyqin@CatBook.local",[[-1,1429,"func"]],[1433,1433],[1429,1429]]],[1523976500223,["tobyqin@CatBook.local",[[1,1429,"your_r"]],[1429,1429],[1435,1435]]],[1523976500752,["tobyqin@CatBook.local",[[-1,1434,"r"]],[1435,1435],[1434,1434]]],[1523976504215,["tobyqin@CatBook.local",[[1,1434,"func():"]],[1434,1434],[1441,1441]]],[1523976504421,["tobyqin@CatBook.local",[[1,1442,"\n"]],[1441,1441],[1442,1442]]],[1523976505406,["tobyqin@CatBook.local",[[1,1442,"  do"]],[1442,1442],[1446,1446]]],[1523976506558,["tobyqin@CatBook.local",[[-1,1444,"do"]],[1446,1446],[1444,1444]]],[1523976508254,["tobyqin@CatBook.local",[[1,1444,"pass"]],[1444,1444],[1448,1448]]],[1523976508485,["tobyqin@CatBook.local",[[1,1449,"\n"]],[1448,1448],[1449,1449]]],[1523976509078,["tobyqin@CatBook.local",[[1,1450,"\n"]],[1449,1449],[1450,1450]]],[1523976510670,["tobyqin@CatBook.local",[[1,1450,"def _"]],[1450,1450],[1455,1455]]],[1523976511262,["tobyqin@CatBook.local",[[-1,1454,"_"]],[1455,1455],[1454,1454]]],[1523976516583,["tobyqin@CatBook.local",[[1,1454,"test_your_func():"]],[1454,1454],[1471,1471]]],[1523976516829,["tobyqin@CatBook.local",[[1,1472,"\n"]],[1471,1471],[1472,1472]]],[1523976528566,["tobyqin@CatBook.local",[[1,1472,"  assert result is "]],[1472,1472],[1491,1491]]],[1523976530349,["tobyqin@CatBook.local",[[-1,1487," is "]],[1491,1491],[1487,1487]]],[1523976531718,["tobyqin@CatBook.local",[[1,1487," == "]],[1487,1487],[1491,1491]]],[1523976533301,["tobyqin@CatBook.local",[[-1,1487," == "]],[1491,1491],[1487,1487]]],[1523976535445,["tobyqin@CatBook.local",[[1,1487," is No"]],[1487,1487],[1493,1493]]],[1523976537572,["tobyqin@CatBook.local",[[-1,1487," is No"]],[1493,1493],[1487,1487]]],[1523976549040,["tobyqin@CatBook.local",[[1,1493,"\n"]],[1491,1491],[1492,1492]]],[1523976558576,["tobyqin@CatBook.local",[[1,1415,"\n"]],[1415,1415],[1416,1416]]],[1523976560887,["tobyqin@CatBook.local",[[1,1493,"zh"]],[1493,1493],[1495,1495]]],[1523976561399,["tobyqin@CatBook.local",[[-1,1493,"zh"]],[1495,1495],[1493,1493]]],[1523976578763,["tobyqin@CatBook.local",[[1,1493,"这样的设计，就让你写单元测试成立"]],[1493,1493],[1509,1509]]],[1523976579217,["tobyqin@CatBook.local",[[-1,1508,"立"]],[1509,1509],[1508,1508]]],[1523976590003,["tobyqin@CatBook.local",[[1,1508,"了顺手拈来的事。"]],[1508,1508],[1516,1516]]],[1523976592297,["tobyqin@CatBook.local",[[-1,1515,"。"]],[1516,1516],[1515,1515]]],[1523976593131,["tobyqin@CatBook.local",[[1,1515,"，"]],[1515,1515],[1516,1516]]],[1523976598531,["tobyqin@CatBook.local",[[1,1516,"比如i西"]],[1516,1516],[1520,1520]]],[1523976599377,["tobyqin@CatBook.local",[[-1,1516,"比如i西"]],[1520,1520],[1516,1516]]],[1523976601234,["tobyqin@CatBook.local",[[1,1516,"加入你"]],[1516,1516],[1519,1519]]],[1523976601816,["tobyqin@CatBook.local",[[-1,1516,"加入你"]],[1519,1519],[1516,1516]]],[1523976629658,["tobyqin@CatBook.local",[[1,1516,"假如你写完了一个方法，想看看是否work，在旁边直接写上一个``"]],[1516,1516],[1548,1548]]],[1523976630257,["tobyqin@CatBook.local",[[1,1547,"t"]],[1547,1547],[1548,1548]]],[1523976630673,["tobyqin@CatBook.local",[[1,1500,"est"]],[1548,1548],[1503,1503]]],[1523976633402,["tobyqin@CatBook.local",[[-1,1500,"est"]],[1503,1503],[1548,1548]]],[1523976636641,["tobyqin@CatBook.local",[[1,1548,"est_"]],[1548,1548],[1552,1552]]],[1523976651522,["tobyqin@CatBook.local",[[1,1553," 开头的方法，稍微准备一下数据就可以测"]],[1553,1553],[1572,1572]]],[1523976651776,["tobyqin@CatBook.local",[[-1,1571,"测"]],[1572,1572],[1571,1571]]],[1523976653105,["tobyqin@CatBook.local",[[1,1571,"run"]],[1571,1571],[1574,1574]]],[1523976653823,["tobyqin@CatBook.local",[[-1,1572,"un"]],[1574,1574],[1572,1572]]],[1523976654020,["tobyqin@CatBook.local",[[-1,1571,"r"]],[1572,1572],[1571,1571]]],[1523976659416,["tobyqin@CatBook.local",[[1,1571,"完成"]],[1571,1571],[1573,1573]]],[1523976660471,["tobyqin@CatBook.local",[[-1,1571,"完成"]],[1573,1573],[1571,1571]]],[1523976664874,["tobyqin@CatBook.local",[[1,1571,"run起来，"]],[1571,1571],[1577,1577]]],[1523976668175,["tobyqin@CatBook.local",[[-1,1571,"run起来，"]],[1577,1577],[1571,1571]]],[1523976678985,["tobyqin@CatBook.local",[[1,1571,"验证这个方法好不好用，岂不妙哉？"]],[1571,1571],[1587,1587]]]]]]}